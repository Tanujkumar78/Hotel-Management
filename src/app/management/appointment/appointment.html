<div class="appointment-container">

  <button class="back-btn" (click)="goBack()">
  ‚Üê Back
</button>


  <h2>Appointment Management</h2>

  <form (ngSubmit)="addAppointment()" class="appointment-form" #appointmentForm="ngForm">
    <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div>
      <label>Patient:</label>
      <select [(ngModel)]="newAppointment.patientId" name="patientId" required #patientSelect="ngModel">
        <option value="">Select Patient</option>
        <option *ngFor="let p of patients" [value]="p.id">
          {{ p.name }}
        </option>
      </select>
      <div class="error-hint" *ngIf="patientSelect.touched && patientSelect.invalid">
        Please select a patient
      </div>
    </div>

    <div>
      <label>Doctor:</label>
      <select [(ngModel)]="newAppointment.doctorId" name="doctorId" required (change)="onSelection($event)" #doctorSelect="ngModel">
        <option value="">Select Doctor</option>
        <option *ngFor="let d of doctors" [value]="d.id">
          {{ d.name }} ({{ d.specialization }})
        </option>
      </select>
      <div class="error-hint" *ngIf="doctorSelect.touched && doctorSelect.invalid">
        Please select a doctor
      </div>
    </div>

    <div>
      <label>Date:</label>
      <input type="date" [(ngModel)]="newAppointment.date" name="date" required 
             [min]="minDate" #dateInput="ngModel" />
      <div class="error-hint" *ngIf="dateInput.touched && dateInput.invalid">
        Please select a valid future date
      </div>
    </div>

    <div>
      <label>Time Slot:</label>
      <select [(ngModel)]="newAppointment.timeSlot" name="timeSlot" required #timeSlot="ngModel">
        <option value="">Select Time Slot</option>
        <option>Morning</option>
        <option>Afternoon</option>
        <option>Evening</option>
      </select>
      <div class="error-hint" *ngIf="timeSlot.touched && timeSlot.invalid">
        Please select a time slot
      </div>
    </div>

    <div class="doctor-info" *ngIf="selectedDoctor">
      <h4>Selected Doctor Information</h4>
      <p>Specialization: {{ selectedDoctor.specialization }}</p>
      <p>Consultation Fee: ${{ selectedDoctor.fee }}</p>
    </div>

    <button type="submit" [disabled]="appointmentForm.invalid">Add Appointment</button>
  </form>

  <table class="appointment-table" *ngIf="appointments.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Patient</th>
        <th>Doctor</th>
        <th>Date</th>
        <th>Time</th>
        <th>Status</th>
        <th>Change Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let app of appointments">
        <td>{{ app.id }}</td>
        <td>{{ app.patientName }}</td>
        <td>{{ app.doctorName }}</td>
        <td>{{ app.date }}</td>
        <td>{{ app.timeSlot }}</td>
        <td>{{ app.status }}</td>
        <td>
          <select
            #statusSelect
            (change)="updateStatus(app, statusSelect.value)"
            [value]="app.status"
          >
            <option>Scheduled</option>
            <option>Completed</option>
          </select>
        </td>
        <td>
          <button (click)="deleteAppointment(app.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
